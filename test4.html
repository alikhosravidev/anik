<!DOCTYPE html>
<html lang="fa" dir="rtl" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¢Ù†ÛŒÚ© - ØªÙ†Ø¸ÛŒÙ… Ø±Ø§ÛŒÚ¯Ø§Ù† Ø´Ú©ÙˆØ§Ø¦ÛŒÙ‡</title>
    <meta name="description" content="ØªÙ†Ø¸ÛŒÙ… Ù‡ÙˆØ´Ù…Ù†Ø¯ Ùˆ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø´Ú©ÙˆØ§Ø¦ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø¬Ø±Ø§ÛŒÙ… Ø®ÛŒØ§Ù†Øª Ø¯Ø± Ø§Ù…Ø§Ù†ØªØŒ ØªÙˆÙ‡ÛŒÙ† Ùˆ Ù…Ø²Ø§Ø­Ù…Øª">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1A3A5F',
                        secondary: '#4A90E2',
                        success: '#27AE60',
                        warning: '#F39C12',
                        bgpaper: '#F9FAFB',
                    },
                    fontFamily: {
                        sans: ['Vazirmatn', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Vazirmatn Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Vazirmatn', sans-serif; }
        .chat-bubble-bot { background:#e5e7eb; align-self: flex-start; }
        .chat-bubble-user { background:#1A3A5F; color:white; align-self: flex-end; }
        .crime-card:hover { transform: translateY(-4px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="min-h-screen bg-[#F9FAFB] flex flex-col">

<!-- Disclaimer Sticky Footer -->
<div class="fixed bottom-0 left-0 right-0 bg-[#FFF3CD] text-center py-2 text-sm text-[#333] z-50 border-t border-orange-300">
    âš ï¸ Ø§ÛŒÙ† Ø³Ø§Ù…Ø§Ù†Ù‡ ÙˆÚ©ÛŒÙ„ Ø¯Ø§Ø¯Ú¯Ø³ØªØ±ÛŒ Ù†ÛŒØ³Øª Ùˆ ØµØ±ÙØ§Ù‹ Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³ Ø§ÙˆØ±Ø§Ù‚ Ù‚Ø¶Ø§ÛŒÛŒ Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ù…Ø³Ø¦ÙˆÙ„ÛŒØª ØµØ­Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ø´Ù…Ø§Ø³Øª.
</div>

<!-- Landing Page -->
<div id="landing" class="flex-1 flex flex-col justify-center items-center px-6 text-center">
    <h1 class="text-4xl font-bold text-primary mb-6">Ø¢Ù†ÛŒÚ©</h1>
    <p class="text-xl text-gray-700 mb-8 max-w-2xl">ØªÙ†Ø¸ÛŒÙ… Ù‡ÙˆØ´Ù…Ù†Ø¯ Ùˆ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø´Ú©ÙˆØ§Ø¦ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø¬Ø±Ø§ÛŒÙ…<br>Ø®ÛŒØ§Ù†Øª Ø¯Ø± Ø§Ù…Ø§Ù†Øª â–ª ØªÙˆÙ‡ÛŒÙ† â–ª Ù…Ø²Ø§Ø­Ù…Øª</p>
    <p class="text-lg text-gray-600 mb-12">Ø¯Ø± Ú©Ù…ØªØ± Ø§Ø² Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡ Ø´Ú©ÙˆØ§Ø¦ÛŒÙ‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯</p>
    <button onclick="showSection('login')" class="bg-primary hover:bg-[#0f2a45] text-white text-xl font-bold py-6 px-12 rounded-2xl shadow-2xl transition">
        ØªÙ†Ø¸ÛŒÙ… Ø±Ø§ÛŒÚ¯Ø§Ù† Ø´Ú©ÙˆØ§Ø¦ÛŒÙ‡
    </button>
</div>

<!-- Login / OTP -->
<div id="login" class="hidden flex-1 flex flex-col justify-center items-center px-6">
    <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
        <h2 class="text-2xl font-bold text-primary mb-6 text-center">ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„</h2>
        <div id="phoneStep">
            <input type="tel" id="phone" placeholder="Û°Û¹Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹" class="w-full border border-gray-300 rounded-xl px-5 py-4 text-lg text-left" dir="ltr">
            <button onclick="sendOTP()" class="mt-6 bg-primary text-white w-full py-4 rounded-xl font-bold text-lg">Ø¯Ø±ÛŒØ§ÙØª Ú©Ø¯ ØªØ§ÛŒÛŒØ¯</button>
        </div>
        <div id="otpStep" class="hidden">
            <p class="text-sm text-gray-600 mb-4">Ú©Ø¯ Ø§Ø±Ø³Ø§Ù„â€ŒØ´Ø¯Ù‡ Ø¨Ù‡ Ø´Ù…Ø§Ø±Ù‡ <span id="sentPhone"></span> Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>
            <input type="text" id="otp" maxlength="5" placeholder="-----" class="w-full border border-gray-300 rounded-xl px-5 py-4 text-center text-2xl tracking-widest" dir="ltr">
            <button onclick="verifyOTP()" class="mt-6 bg-success text-white w-full py-4 rounded-xl font-bold text-lg">ÙˆØ±ÙˆØ¯ Ùˆ Ø´Ø±ÙˆØ¹</button>
        </div>
    </div>
</div>

<!-- Chat Interface -->
<div id="chat" class="hidden flex-1 flex flex-col bg-[#F9FAFB]">
    <div class="flex-1 overflow-y-auto px-4 py-6" id="chatMessages">
        <!-- Messages injected here -->
    </div>

    <div class="bg-white border-t border-gray-200 p-4">
        <div id="quickReplies" class="flex flex-wrap gap-3 justify-center"></div>
        <div id="textInputArea" class="hidden">
            <input type="text" id="textInput" class="w-full border rounded-xl px-5 py-4" placeholder="Ù¾Ø§Ø³Ø® Ø´Ù…Ø§...">
            <button onclick="sendText()" class="bg-primary text-white px-6 py-3 rounded-xl mr-2">Ø§Ø±Ø³Ø§Ù„</button>
        </div>
    </div>
</div>

<!-- Result / Download -->
<div id="result" class="hidden flex-1 flex flex-col items-center px-6 py-12">
    <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-3xl">
        <h2 class="text-2xl font-bold text-success text-center mb-8">Ø´Ú©ÙˆØ§Ø¦ÛŒÙ‡ Ø´Ù…Ø§ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª!</h2>
        <div id="documentPreview" class="bg-gray-50 border-2 border-dashed rounded-xl p-8 text-center min-h-96">
            Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø³Ù†Ø¯...
        </div>
        <div class="mt-8 flex justify-center gap-6">
            <button onclick="downloadPDF()" class="bg-primary text-white py-4 px-10 rounded-xl font-bold">Ø¯Ø§Ù†Ù„ÙˆØ¯ PDF</button>
            <button onclick="downloadWord()" class="bg-secondary text-white py-4 px-10 rounded-xl font-bold">Ø¯Ø§Ù†Ù„ÙˆØ¯ Word</button>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jspdf@latest/dist/jspdf.umd.min.js"></script>
<script>
    // Simple state
    let currentStep = 0;
    let userData = {};
    let phoneNumber = '';

    const steps = [
        // 0: Welcome + Crime selection
        { type: 'bot', text: 'Ø¨Ø§ Ø³Ù„Ø§Ù…. Ù„Ø·ÙØ§Ù‹ Ù†ÙˆØ¹ Ù…Ø´Ú©Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:',
            options: [
                {text: 'ğŸ¤ Ø®ÛŒØ§Ù†Øª Ø¯Ø± Ø§Ù…Ø§Ù†Øª (Ø®ÙˆØ¯Ø±ÙˆØŒ Ú†Ú©ØŒ Ø³ÙØªÙ‡...)', value: 'amanat'},
                {text: 'ğŸ—£ï¸ ØªÙˆÙ‡ÛŒÙ† Ùˆ ÙØ­Ø§Ø´ÛŒ (ÙØ¶Ø§ÛŒ Ù…Ø¬Ø§Ø²ÛŒ ÛŒØ§ Ø­Ù‚ÛŒÙ‚ÛŒ)', value: 'tohin'},
                {text: 'ğŸ“ Ù…Ø²Ø§Ø­Ù…Øª ØªÙ„ÙÙ†ÛŒ ÛŒØ§ Ø­Ø¶ÙˆØ±ÛŒ', value: 'mozahemat'}
            ]},

        // Ø®ÛŒØ§Ù†Øª Ø¯Ø± Ø§Ù…Ø§Ù†Øª branch
        { type: 'bot', text: 'Ø¢ÛŒØ§ Ù…Ø§Ù„ ÛŒØ§ Ù¾ÙˆÙ„ÛŒ Ø¨Ù‡ Ø·Ø±Ù Ù…Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒØ¯ Ú©Ù‡ Ù‚Ø±Ø§Ø± Ø¨ÙˆØ¯ Ø¹ÛŒÙ† Ø¢Ù† Ø±Ø§ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯ØŸ', options: ['Ø¨Ù„Ù‡', 'Ø®ÛŒØ±'], branch: 'amanat1' },
        { type: 'bot', text: 'Ø¢ÛŒØ§ Ù…Ø¯Ø±Ú© Ù…Ú©ØªÙˆØ¨ (Ø±Ø³ÛŒØ¯ØŒ Ù¾ÛŒØ§Ù…Ú©ØŒ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯) Ø¯Ø§Ø±ÛŒØ¯ØŸ', options: ['Ø¨Ù„Ù‡', 'Ø®ÛŒØ±'], branch: 'amanat2' },

        // ØªÙˆÙ‡ÛŒÙ† branch
        { type: 'bot', text: 'Ø¢ÛŒØ§ ØªÙˆÙ‡ÛŒÙ† Ù†Ø§Ù…ÙˆØ³ÛŒ ÛŒØ§ Ø±Ú©ÛŒÚ© Ø¨ÙˆØ¯Ù‡ Ø§Ø³ØªØŸ', options: ['Ø¨Ù„Ù‡', 'Ø®ÛŒØ±'], branch: 'tohin1' },
        { type: 'bot', text: 'Ø¢ÛŒØ§ ØªÙˆÙ‡ÛŒÙ† Ø¨Ù‡ Ú©Ø§Ø±Ù…Ù†Ø¯ Ø¯ÙˆÙ„Øª Ø¯Ø± Ø­ÛŒÙ† Ø§Ù†Ø¬Ø§Ù… ÙˆØ¸ÛŒÙÙ‡ Ø¨ÙˆØ¯Ù‡ØŸ', options: ['Ø¨Ù„Ù‡', 'Ø®ÛŒØ±'], branch: 'tohin2' },

        // Lead generation
        { type: 'lead', text: 'Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ù…ÙˆØ¶ÙˆØ¹ Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø®Ø¯Ù…Ø§Øª Ø±Ø§ÛŒÚ¯Ø§Ù† Ù…Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§ÙˆØ±Ù‡ ØªØ®ØµØµÛŒØŒ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ØªØ§ Ù‡Ù…Ú©Ø§Ø±Ø§Ù† Ù…Ø§ Ø¨Ø§ Ø´Ù…Ø§ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±Ù†Ø¯.' },

        // Final questions (generic)
        { type: 'bot', text: 'ØªØ§Ø±ÛŒØ® Ø¯Ù‚ÛŒÙ‚ ÛŒØ§ ØªÙ‚Ø±ÛŒØ¨ÛŒ ÙˆÙ‚ÙˆØ¹ Ø¬Ø±Ù…ØŸ', input: 'date' },
        { type: 'bot', text: 'Ù…Ø­Ù„ ÙˆÙ‚ÙˆØ¹ Ø¬Ø±Ù… (Ø´Ù‡Ø± Ùˆ Ø®ÛŒØ§Ø¨Ø§Ù†)ØŸ', input: 'text' },
        { type: 'bot', text: 'Ù†Ø§Ù… Ùˆ Ù†Ø§Ù…â€ŒØ®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ù…ØªÙ‡Ù… Ø±Ø§ Ù…ÛŒâ€ŒØ¯Ø§Ù†ÛŒØ¯ØŸ', options: ['Ø¨Ù„Ù‡', 'Ø®ÛŒØ±'] },
        { type: 'bot', text: 'Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ù…ØªÙ‡Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ø¯Ø± ØµÙˆØ±Øª Ù†Ø§Ø´Ù†Ø§Ø³ Ø¨ÙˆØ¯Ù† Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯: Ù†Ø§Ø´Ù†Ø§Ø³)', input: 'text' },
    ];

    function showSection(section) {
        document.querySelectorAll('#landing, #login, #chat, #result').forEach(el => el.classList.add('hidden'));
        document.getElementById(section).classList.remove('hidden');
    }

    function addMessage(text, type = 'bot', options = null) {
        const container = document.getElementById('chatMessages');
        const bubble = document.createElement('div');
        bubble.className = `max-w-xs lg:max-w-md px-5 py-4 rounded-2xl my-3 ${type==='user' ? 'chat-bubble-user' : 'chat-bubble-bot'}`;
        bubble.innerHTML = text;
        container.appendChild(bubble);
        container.scrollTop = container.scrollHeight;

        if (options) {
            const qr = document.getElementById('quickReplies');
            qr.innerHTML = '';
            options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'bg-gray-200 hover:bg-gray-300 px-6 py-3 rounded-full text-sm font-medium';
                btn.textContent = typeof opt === 'object' ? opt.text : opt;
                btn.onclick = () => userReply(typeof opt === 'object' ? opt.value : opt);
                qr.appendChild(btn);
            });
        } else {
            document.getElementById('quickReplies').innerHTML = '';
        }
    }

    function userReply(value) {
        addMessage(value, 'user');
        userData[`step${currentStep}`] = value;
        nextStep();
    }

    function sendText() {
        const input = document.getElementById('textInput');
        if (!input.value.trim()) return;
        userReply(input.value);
        input.value = '';
        document.getElementById('textInputArea').classList.add('hidden');
    }

    function nextStep() {
        currentStep++;
        const step = steps[currentStep];
        if (!step) {
            // End of flow â†’ Result
            generateDocument();
            return;
        }

        if (step.input) {
            document.getElementById('textInputArea').classList.remove('hidden');
            document.getElementById('textInput').focus();
            addMessage(step.text);
            return;
        }

        if (step.type === 'lead') {
            addMessage(step.text);
            document.getElementById('textInputArea').classList.remove('hidden');
            return;
        }

        // Simple branching example
        if (currentStep === 1 && userData.step0 === 'amanat' && userData.step1 === 'Ø®ÛŒØ±') {
            currentStep = steps.findIndex(s => s.type === 'lead');
            nextStep();
            return;
        }

        addMessage(step.text, 'bot', step.options || null);
    }

    function startChat() {
        showSection('chat');
        currentStep = -1;
        userData = {};
        document.getElementById('chatMessages').innerHTML = '';
        addMessage('Ø¨Ø§ Ø³Ù„Ø§Ù…. Ø¬Ù‡Øª ØªÙ†Ø¸ÛŒÙ… Ø´Ú©ÙˆØ§Ø¦ÛŒÙ‡ Ø¨Ù‡ Ø³ÙˆØ§Ù„Ø§Øª Ø²ÛŒØ± Ù¾Ø§Ø³Ø® Ø¯Ù‡ÛŒØ¯.');
        nextStep();
    }

    function sendOTP() {
        phoneNumber = document.getElementById('phone').value;
        if (!/^09[0-9]{9}$/.test(phoneNumber)) {
            alert('Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
            return;
        }
        document.getElementById('sentPhone').textContent = phoneNumber;
        document.getElementById('phoneStep').classList.add('hidden');
        document.getElementById('otpStep').classList.remove('hidden');
        // Simulate OTP send
        console.log('OTP sent to ' + phoneNumber);
    }

    function verifyOTP() {
        const otp = document.getElementById('otp').value;
        if (otp.length !== 5) {
            alert('Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Ûµ Ø±Ù‚Ù…ÛŒ Ø§Ø³Øª');
            return;
        }
        // Simulate success
        startChat();
    }

    function generateDocument() {
        // Simple template population
        const docText = `Ø±ÛŒØ§Ø³Øª Ù…Ø­ØªØ±Ù… Ø¯Ø§Ø¯Ø³Ø±Ø§
Ø§Ø­ØªØ±Ø§Ù…Ø§Ù‹ Ø¯Ø± ØªØ§Ø±ÛŒØ® ${userData.step5 || '...'} Ø¯Ø± Ù…Ø­Ù„ ${userData.step6 || '...'}ØŒ Ù…Ø´ØªÚ©ÛŒâ€ŒØ¹Ù†Ù‡ Ø¨Ù‡ Ù†Ø§Ù… ${userData.step8 || 'Ù†Ø§Ø´Ù†Ø§Ø³'} Ø§Ù‚Ø¯Ø§Ù… Ø¨Ù‡ ${userData.step0 === 'amanat' ? 'Ø®ÛŒØ§Ù†Øª Ø¯Ø± Ø§Ù…Ø§Ù†Øª (Ù…Ø§Ø¯Ù‡ Û¶Û·Û´)' : userData.step0 === 'tohin' ? 'ØªÙˆÙ‡ÛŒÙ†' : 'Ù…Ø²Ø§Ø­Ù…Øª'} Ù†Ù…ÙˆØ¯...`;

        document.getElementById('documentPreview').innerText = docText;
        showSection('result');

        window.docContent = docText; // for PDF
    }

    function downloadPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFont('Vazirmatn', 'normal'); // fallback
        doc.text(window.docContent || 'Ø´Ú©ÙˆØ§Ø¦ÛŒÙ‡', 10, 10);
        doc.save('Ø´Ú©ÙˆØ§Ø¦ÛŒÙ‡-Ø¢Ù†ÛŒÚ©.pdf');
    }

    function downloadWord() {
        const content = '<html><body dir="rtl"><pre>' + (window.docContent || 'Ø´Ú©ÙˆØ§Ø¦ÛŒÙ‡') + '</pre></body></html>';
        const blob = new Blob(['\ufeff', content], { type: 'application/msword' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'Ø´Ú©ÙˆØ§Ø¦ÛŒÙ‡-Ø¢Ù†ÛŒÚ©.doc';
        a.click();
    }
</script>
</body>
</html>