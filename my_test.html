<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>آنِیک سامانه - تنظیم شکوائیه حرفه‌ای</title>
    
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e3a8a',
                        primaryDark: '#172554',
                        secondary: '#64748b',
                        surface: '#ffffff',
                        background: '#f1f5f9',
                        border: '#e2e8f0',
                    },
                    fontFamily: {
                        sans: ['Vazirmatn', 'sans-serif'],
                        serif: ['Times New Roman', 'serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Vazirmatn', sans-serif; background-color: #f1f5f9; color: #1e293b; overflow-x: hidden; }
        .fade-enter { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* استایل کاغذ قانونی */
        .legal-paper {
            font-family: 'Times New Roman', serif; line-height: 2; text-align: justify; background: #fff;
            padding: 60px; border: 1px solid #cbd5e1; box-shadow: 0 10px 40px rgba(0,0,0,0.1); direction: rtl; min-height: 800px;
        }
        .legal-paper::before { content: "PREVIEW"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg); font-size: 100px; color: rgba(0,0,0,0.04); font-weight: bold; letter-spacing: 10px; pointer-events: none; }
        .legal-paper h1 { text-align: center; font-weight: bold; font-size: 18pt; margin-bottom: 40px; color: #000; border-bottom: 2px solid #000; padding-bottom: 10px;}

        /* گرافیک سه بعدی */
        .graphic-container { position: relative; width: 100%; height: 450px; perspective: 1000px; }
        .shield-bg { position: absolute; inset: 0; background: linear-gradient(135deg, #e0f2fe 0%, #eff6ff 50%, #f1f5f9 100%); border-radius: 3rem; transform: rotate(-3deg); }
        .doc-mockup { position: absolute; top: 15%; left: 15%; width: 65%; height: 75%; background: white; border-radius: 0.5rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15); transform: rotate(-6deg); z-index: 10; padding: 2rem; }
        .shield-icon { position: absolute; bottom: 12%; right: 10%; width: 120px; height: 120px; background: linear-gradient(135deg, #10b981 0%, #065f46 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 20px 25px -5px rgba(4, 120, 87, 0.4); z-index: 20; color: white; }

        /* ویزارد */
        .wizard-wrapper {
            display: flex; flex-direction: column;
            min-height: calc(100vh - 80px);
            background: #fff; border: 1px solid var(--border); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); border-radius: 1.5rem; margin: 2rem auto; max-width: 900px;
        }
        @media (min-width: 1024px) { .wizard-wrapper { flex-direction: row; height: calc(100vh - 90px); } }

        .wizard-sidebar {
            width: 100%; background: #f8fafc; border-bottom: 1px solid var(--border);
            padding: 2.5rem; flex-shrink: 0; display: flex; flex-direction: column;
        }
        @media (min-width: 1024px) { .wizard-sidebar { width: 350px; border-bottom: none; border-left: 1px solid var(--border); } }

        .step-item { display: flex; align-items: flex-start; gap: 1rem; margin-bottom: 2.5rem; opacity: 0.4; transition: all 0.3s ease; position: relative; }
        .step-item::after { content: ''; position: absolute; right: 0.65rem; top: 0; bottom: 0; width: 2px; background: #e2e8f0; }
        .step-item:last-child::after { display: none; }
        .step-item.active { opacity: 1; }
        .step-item.active::after { background: var(--primary); }
        .step-item.done { opacity: 0.8; }
        
        .step-circle { width: 32px; height: 32px; border-radius: 50%; background: #fff; border: 2px solid #e2e8f0; color: #94a3b8; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.9rem; flex-shrink: 0; z-index: 2; transition: all 0.3s; }
        .step-item.active .step-circle { background: var(--primary); border-color: var(--primary); color: #fff; box-shadow: 0 0 0 4px rgba(30, 58, 138, 0.2); }
        .step-item.done .step-circle { background: #10b981; border-color: #10b981; color: #fff; }

        .wizard-main { flex: 1; display: flex; flex-direction: column; background: #fff; position: relative; }
        .wizard-header { padding: 1.5rem 2rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        
        .question-card { padding: 2rem; flex: 1; display: flex; flex-direction: column; justify-content: center; max-width: 700px; margin: 0 auto; width: 100%; }
        .question-text { font-size: 1.75rem; font-weight: 700; color: #0f172a; text-align: center; margin-bottom: 3rem; line-height: 1.5; font-family: 'Times New Roman', serif; }

        /* ورودی‌ها */
        .options-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 2.5rem; width: 100%; }
        .option-btn {
            background: #fff; border: 1px solid #cbd5e1; padding: 1.25rem; border-radius: 0.75rem;
            text-align: right; cursor: pointer; transition: all 0.2s; font-weight: 600; color: #475569; position: relative;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05);
        }
        .option-btn::after { content: '›'; font-weight: bold; font-size: 1.2rem; opacity: 0.3; }
        .option-btn:hover { border-color: #0f172a; background: #f8fafc; color: #0f172a; transform: translateY(-2px); }

        .input-wrapper { margin-top: 1.5rem; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; position: relative; }
        .text-input {
            width: 100%; background: transparent; border: none; border-bottom: 1.5px solid #e2e8f0;
            padding: 1rem 0.5rem; font-size: 1.125rem; outline: none; transition: all 0.3s; text-align: center;
        }
        .text-input:focus { border-bottom-color: #0f172a; padding-bottom: 1rem; }
        .input-label {
            position: absolute; top: -0.25rem; right: 0.5rem; background: #fff; padding: 0 0.5rem; font-size: 0.75rem; color: #64748b; font-weight: 600;
        }

        /* دکمه اصلی */
        .btn-primary {
            display: block; 
            width: 100%; 
            max-width: 320px; 
            margin: 3rem auto 0;
            background: #1e3a8a; 
            color: #ffffff; 
            padding: 1rem; 
            border-radius: 0.75rem; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.2s; 
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(30, 58, 138, 0.3); 
            font-size: 1.1rem;
            z-index: 50;
        }
        .btn-primary:hover { background: #1e40af; transform: translateY(-2px); }
        
        .btn-secondary { display: block; width: 100%; max-width: 320px; margin: 0 auto; background: transparent; border: 1px solid #cbd5e1; color: #64748b; padding: 0.75rem; border-radius: 0.75rem; cursor: pointer; transition: all 0.2s; text-align: center; font-weight: 500; }
        .btn-secondary:hover { background: #f1f5f9; color: #0f172a; border-color: #94a3b8; }

        @media print {
            body * { visibility: hidden; }
            #printable-area, #printable-area * { visibility: visible; }
            #printable-area { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 0; box-shadow: none; border: none; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header class="fixed top-0 w-full z-50 bg-white/95 backdrop-blur-md border-b border-slate-200 h-20 flex items-center transition-all duration-300">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-primary/10 p-2.5 rounded-lg">
                    <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"></path></svg>
                </div>
                <div class="border-r border-slate-200 pr-4">
                    <div>
                        <span class="text-2xl font-serif font-bold tracking-tight text-primary block leading-none">آنِیک سامانه</span>
                        <span class="text-[10px] text-slate-500 tracking-widest uppercase font-serif block leading-none">Legal System Enterprise</span>
                    </div>
                </div>
            </div>
            <nav class="hidden md:flex items-center gap-6 text-sm font-medium text-slate-600">
                <a href="#" class="hover:text-primary transition-colors">درباره ما</a>
                <a href="#" class="hover:text-primary transition-colors">تعرفه</a>
                <a href="#" class="hover:text-primary transition-colors">سوالات متداول</a>
                <a href="#" class="bg-primary hover:bg-slate-800 text-white px-6 py-2.5 rounded transition-all shadow-lg">ورود متخصصین</a>
            </nav>
        </div>
    </header>

    <!-- محتوا -->
    <main class="flex-grow pt-24 pb-12 container mx-auto px-4 sm:px-6 lg:px-8 relative">
        <div class="absolute top-0 left-0 w-full h-96 bg-gradient-to-b from-slate-50/30 to-transparent -z-10 rounded-b-[3rem] pointer-events-none"></div>

        <!-- 1. لندینگ -->
        <section id="landing-view" class="max-w-6xl mx-auto py-16 lg:py-24">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
                <div class="order-2 lg:order-1 space-y-8">
                    <div class="bg-primary/5 inline-flex items-center gap-2 px-3 py-1 rounded-full text-primary text-xs font-bold tracking-wider">
                        <span class="w-1.5 h-1.5 bg-primary rounded-full"></span>
                        هوش مصنوعی حقوقی پیشرفته
                    </div>
                    <h1 class="text-4xl md:text-6xl font-serif font-bold text-slate-900 leading-tight">
                        تنظیم شکوائیه هوشمند<br>
                        <span class="text-primary">در کوتاه‌ترین زمان ممکن</span>
                    </h1>
                    <p class="text-lg text-slate-600 leading-relaxed max-w-xl">
                        سامانه آنِیک با استفاده از هوش مصنوعی، پیش‌نویس دقیق و استاندارد شکوائیه شما را تولید می‌کند.
                    </p>
                    <div class="flex flex-wrap gap-4 pt-6">
                        <button id="btn-start" class="bg-primary hover:bg-slate-800 text-white font-bold py-4 px-10 rounded shadow-lg shadow-primary/20 transition-all hover:scale-[1.01] flex items-center gap-3">
                            <span>شروع رایگان</span>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                        </button>
                        <button id="btn-guide" class="bg-white hover:bg-gray-50 text-primary border border-slate-200 font-bold py-4 px-10 rounded transition-all flex items-center gap-2 shadow-sm">
                            <span>راهنما</span>
                        </button>
                    </div>
                    <div class="flex items-center gap-12 pt-8 border-t border-slate-100 mt-8">
                        <div><p class="text-3xl font-serif font-bold text-slate-900">+۵۰k</p><p class="text-xs text-slate-500 font-semibold uppercase tracking-wide">کاربر فعال</p></div>
                        <div class="w-px h-10 bg-slate-200"></div>
                        <div><p class="text-3xl font-serif font-bold text-slate-900">۹۸٪</p><p class="text-xs text-slate-500 font-semibold uppercase tracking-wide">رضایت وکلایان</p></div>
                    </div>
                </div>
                <div class="order-1 lg:order-2 relative graphic-container">
                    <div class="shield-bg"></div>
                    <div class="doc-mockup">
                        <div class="h-4 w-24 bg-slate-100 rounded mb-6"></div>
                        <div class="space-y-4">
                            <div class="h-3 bg-slate-50 rounded w-full"></div>
                            <div class="h-3 bg-slate-50 rounded w-5/6"></div>
                            <div class="h-3 bg-slate-50 rounded w-4/6"></div>
                        </div>
                        <div class="mt-8 flex gap-3">
                            <div class="h-10 w-1/3 bg-slate-100 rounded"></div>
                            <div class="h-10 w-1/3 bg-slate-100 rounded"></div>
                        </div>
                    </div>
                    <div class="shield-icon">
                        <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                    </div>
                    <div class="absolute top-10 right-10 w-full h-full bg-gradient-to-br from-blue-100 to-white rounded-3xl -z-10 blur-3xl opacity-70"></div>
                </div>
            </div>
        </section>

        <!-- 2. ورود -->
        <section id="login-view" class="hidden max-w-lg mx-auto mt-12 fade-enter">
            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                <div class="bg-primary p-10 text-center relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                    <h2 class="text-3xl font-serif font-bold text-white relative z-10">ورود به سامانه امن</h2>
                    <p class="text-blue-100 text-sm mt-2 relative z-10">جهت اطمینان و حفظ امنیت اطلاعات کاربر</p>
                </div>
                <div class="p-10">
                    <div id="step-phone">
                        <label class="block text-sm font-bold text-slate-700 mb-3">شماره تلفن همراه</label>
                        <!-- ورودی ساده و تمیز -->
                        <input type="tel" id="mobile-input" placeholder="0912 345 6789" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-4 text-left focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all font-mono text-lg tracking-wide">
                        <button id="btn-send-otp" class="w-full bg-primary hover:bg-slate-800 text-white font-bold py-4 rounded-xl mt-6 transition-all shadow-lg shadow-primary/20">ارسال کد تایید</button>
                    </div>
                    <div id="step-otp" class="hidden text-center">
                        <div class="w-20 h-20 bg-blue-50 text-primary rounded-full flex items-center justify-center mx-auto mb-6 text-3xl border-4 border-white shadow-sm">
                            <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                        </div>
                        <p class="text-slate-600 mb-6">کد ارسال شده به <span id="display-mobile" class="font-bold text-primary"></span> را وارد کنید.</p>
                        <input type="number" id="otp-input" class="w-full text-center text-3xl tracking-widest border-b-2 border-slate-200 focus:border-primary outline-none pb-2 mb-8 bg-transparent font-mono" placeholder="- - -">
                        <button id="btn-verify-otp" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-4 rounded-xl transition-all shadow-lg shadow-emerald-500/20">تایید و ورود</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. داشبورد -->
        <section id="dashboard-view" class="hidden">
            <div class="max-w-4xl mx-auto">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-serif font-bold text-slate-900 mb-3">پنل خدمات حقوقی</h2>
                    <p class="text-slate-500">لطفاً دسته‌بندی پرونده حقوقی خود را انتخاب کنید</p>
                </div>
                <div class="grid md:grid-cols-3 gap-8">
                    <button data-crime="betrayal" class="crime-btn relative h-72 bg-white rounded-2xl shadow-sm border border-slate-200 hover:shadow-lg hover:border-blue-400 transition-all duration-300 overflow-hidden">
                        <div class="absolute top-0 right-0 w-40 h-40 bg-blue-50 rounded-bl-full -mr-8 -mt-8 transition-colors hover:bg-blue-100"></div>
                        <div class="relative z-10 p-8 h-full flex flex-col items-start">
                            <div class="bg-blue-600 text-white p-3 rounded-xl shadow-lg mb-4 z-10">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            </div>
                            <div class="mt-auto z-10 w-full">
                                <h3 class="text-2xl font-serif font-bold text-slate-900 mb-2">خیانت در امانت</h3>
                                <p class="text-sm text-slate-500">ماده ۶۷۴</p>
                            </div>
                        </div>
                    </button>
                    <button data-crime="insult" class="crime-btn relative h-72 bg-white rounded-2xl shadow-sm border border-slate-200 hover:shadow-lg hover:border-red-400 transition-all duration-300 overflow-hidden">
                        <div class="absolute top-0 right-0 w-40 h-40 bg-red-50 rounded-bl-full -mr-8 -mt-8 transition-colors hover:bg-red-100"></div>
                        <div class="relative z-10 p-8 h-full flex flex-col items-start">
                            <div class="bg-red-600 text-white p-3 rounded-xl shadow-lg mb-4 z-10">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                            </div>
                            <div class="mt-auto z-10 w-full">
                                <h3 class="text-2xl font-serif font-bold text-slate-900 mb-2">توهین و افترا</h3>
                                <p class="text-sm text-slate-500">ماده ۶۰۸ و ۶۰۹</p>
                            </div>
                        </div>
                    </button>
                    <button data-crime="harassment" class="crime-btn relative h-72 bg-white rounded-2xl shadow-sm border border-slate-200 hover:shadow-lg hover:border-amber-400 transition-all duration-300 overflow-hidden">
                        <div class="absolute top-0 right-0 w-40 h-40 bg-amber-50 rounded-bl-full -mr-8 -mt-8 transition-colors hover:bg-amber-100"></div>
                        <div class="relative z-10 p-8 h-full flex flex-col items-start">
                            <div class="bg-amber-600 text-white p-3 rounded-xl shadow-lg mb-4 z-10">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                            </div>
                            <div class="mt-auto z-10 w-full">
                                <h3 class="text-2xl font-serif font-bold text-slate-900 mb-2">مزاحمت تلفنی</h3>
                                <p class="text-sm text-slate-500">ماده ۶۴۱</p>
                            </div>
                        </div>
                    </button>
                </div>
            </div>
        </section>

        <!-- 4. ویزارد -->
        <section id="wizard-view" class="hidden">
            <div class="wizard-wrapper">
                <div class="wizard-sidebar">
                    <div class="mb-10">
                        <h3 class="font-serif font-bold text-primary text-xl">گردش کار پرونده</h3>
                        <p class="text-slate-400 text-xs mt-1">تکمیل اطلاعات</p>
                    </div>
                    
                    <div id="timeline-area" class="flex-1 space-y-4 overflow-y-auto pr-4">
                        <!-- رندر توسط JS -->
                    </div>
                    
                    <div class="mt-auto">
                        <div class="bg-slate-50 p-4 rounded text-xs text-slate-500 leading-6 border border-slate-200">
                            <span class="font-bold text-slate-700 block mb-1">⚠️ نکته مهم:</span>
                            <p>پاسخ‌های شما مستقیماً متن شکوائیه را شکل می‌دهند.</p>
                        </div>
                    </div>
                </div>

                <div class="wizard-main">
                    <div class="wizard-header">
                        <div class="flex items-center gap-2">
                            <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                            <span class="font-bold text-slate-800 text-sm">مدیریت اطلاعات پرونده</span>
                        </div>
                        <button id="btn-back" class="text-slate-400 hover:text-primary transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m5 5v12"></path></svg>
                        </button>
                    </div>

                    <div id="wizard-content" class="question-card">
                        <h2 id="question-title" class="question-text fade-enter"></h2>
                        <div id="input-area" class="mt-8"></div>
                        <!-- دکمه تایید همیشه اینجا ساخته می‌شود -->
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. نتیجه -->
        <section id="result-view" class="hidden pb-20">
            <div class="flex justify-between items-center mb-6 px-4">
                <div>
                    <h2 class="text-2xl font-serif font-bold text-slate-900">تولید سند موفق</h2>
                    <p class="text-sm text-slate-500 mt-1">پیش‌نویس آماده چاپ و تحویل است</p>
                </div>
                <button id="btn-reset" class="bg-white border border-slate-300 text-slate-600 hover:bg-slate-50 px-4 py-2 rounded-lg hover:bg-slate-50 transition-colors text-sm font-medium">پرونده جدید</button>
            </div>
            <div class="grid lg:grid-cols-4 gap-8 px-4">
                <div class="lg:col-span-1 space-y-6">
                    <!-- اطلاعات پرونده -->
                    <div class="bg-white p-6 rounded shadow-sm border border-slate-200">
                        <h4 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                            اطلاعات پرونده
                        </h4>
                        <div id="summary-info" class="text-sm text-slate-600 space-y-3 text-sm"></div>
                    </div>
                    
                    <!-- بخش جدید: تکمیل نهایی سند (قبل از دانلود) -->
                    <div class="bg-slate-50 p-5 rounded shadow-sm border border-slate-200">
                        <h4 class="font-bold text-slate-800 mb-4 text-sm">✍️ تکمیل نهایی سند</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-2">مطالب خواسته (جریمه)</label>
                                <input type="text" id="final-claims" class="w-full bg-white border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary focus:border-primary outline-none" placeholder="مثلاً: صد میلیون تومان">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-2">منابع و مدارک (رفرنس)</label>
                                <input type="text" id="final-references" class="w-full bg-white border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary focus:border-primary outline-none" placeholder="مثلاً: عکس پیامک، چک، شناسنامه">
                            </div>
                            <button id="btn-update-doc" class="w-full bg-white border border-primary text-primary hover:bg-primary hover:text-white font-bold py-2 rounded-lg text-sm transition-colors flex items-center justify-center gap-2 mt-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582a1 1 0 01.707.293l2.147-2.147a1 1 0 01.707.293l-2.147-2.147A1 1 0 003.582 4H3a2 2 0 00-2 2v5"></path></svg>
                                بروزرسانی سند
                            </button>
                        </div>
                    </div>

                    <!-- سلب مسئولیت -->
                    <div class="bg-slate-800 text-slate-200 p-5 rounded shadow-lg text-xs leading-6">
                        <p class="font-bold text-white mb-2">⚠️ سلب مسئولیت حقوقی</p>
                        <p>این سند پیش‌نویس هوشمند است. مسئولیت صحت اطلاعات و نحوه ارائه آن در دادگاه کاملاً بر عهده کاربر است.</p>
                    </div>
                </div>
                <div class="lg:col-span-3">
                    <div class="bg-white rounded shadow-sm border border-slate-200 overflow-hidden h-full flex flex-col">
                        <div class="flex items-center justify-between px-6 py-4 border-b border-slate-100 bg-slate-50/30">
                            <div class="flex items-center gap-4">
                                <button id="btn-print" class="bg-primary hover:bg-slate-800 text-white px-5 py-2.5 rounded-lg text-sm font-bold shadow-md shadow-primary/20 flex items-center gap-2 transition-all">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                    دانلود PDF
                                </button>
                            </div>
                            <div class="text-xs text-slate-500">تاریخ: <span class="font-bold text-slate-700" id="doc-date"></span></div>
                        </div>
                        <div class="p-8 bg-slate-100 overflow-y-auto flex-1"><div id="printable-area" class="legal-paper mx-auto max-w-3xl"></div></div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-white border-t border-slate-100 py-8 mt-auto relative z-20">
        <div class="container mx-auto px-4 text-center">
            <p class="text-sm text-slate-500">© ۱۴۰۳ آنِیک سامانه. تمامی حقوق محفوظ است.</p>
        </div>
    </footer>

    <div id="toast" class="fixed top-24 left-1/2 transform -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-xl shadow-2xl opacity-0 pointer-events-none transition-opacity duration-300 z-[200] text-sm flex items-center gap-3">
        <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        <span id="toast-msg">پیام سیستم</span>
    </div>

    <script>
        const app = {
            state: { view: 'landing-view', mobile: '', selectedCrime: null, step: 0, answers: {}, claims: '', references: '' },
            // سوالات (بدون بخش مناف و مطالب خواسته)
            questions: {
                betrayal: [
                    { id: 'item_type', text: 'عنوان موضوع مورد امانت داری:', type: 'choice', options: ['پول نقد', 'چک و سفته', 'اشیاء قیمتی'] },
                    { id: 'return_agreement', text: 'آیا تعهد بازگرداندن عین مال وجود دارد؟', type: 'choice', options: ['بله، دقیقاً همان', 'خیر، معادل یا فرق دارد'] },
                    { id: 'evidence', text: 'آیا مدرک معتبر دارید؟', type: 'choice', options: ['بله، مدرک دارم', 'خیر، صرفاً ادعا'] },
                    { id: 'date', text: 'تاریخ واقعه:', type: 'text', placeholder: 'مثلاً: ۱۴۰۳/۰۸/۱۵' },
                    { id: 'dellal', text: 'شرح دلایل و توضیحات تکمیلی:', type: 'text', placeholder: 'به علت عدم استرداد...' }
                ],
                insult: [
                    { id: 'type', text: 'نوع توهین:', type: 'choice', options: ['فحاشی ناموسی', 'توهین به شخصیت', 'تهمت'] },
                    { id: 'medium', text: 'بستر توهین:', type: 'choice', options: ['شفاهی', 'فضای مجازی', 'پیامک'] },
                    { id: 'gov_employee', text: 'وضعیت توهین‌کننده:', type: 'choice', options: ['کارمند دولت', 'شخص عادی'] },
                    { id: 'date', text: 'تاریخ واقعه:', type: 'text', placeholder: 'مثلاً: ۱۴۰۳/۰۸/۱۵' },
                    { id: 'dellal', text: 'شرح دلایل وقوع جرم:', type: 'text', placeholder: 'توهین به علت...' }
                ],
                harassment: [
                    { id: 'type', text: 'شکل مزاحمت:', type: 'choice', options: ['تلفنی مکرر', 'پیامکی', 'پیگیری'] },
                    { id: 'frequency', text: 'تعداد و مدت مزاحمت:', type: 'text', placeholder: 'مثلاً: روزانه ۵ بار' },
                    { id: 'relation', text: 'آیا شناخت قبلی داشتید؟', type: 'choice', options: ['بله', 'خیر'] },
                    { id: 'date', text: 'تاریخ شروع:', type: 'text', placeholder: 'مثلاً: ۱۴۰۳/۰۸/۱' },
                    { id: 'dellal', text: 'شرح دلایل:', type: 'text', placeholder: 'شروع مزاحمت از تاریخ...' }
                ]
            },
            init: function() {
                this.bindEvents();
            },
            bindEvents: function() {
                const s = (id) => document.getElementById(id);
                s('btn-start').onclick = () => this.nav('login-view');
                s('btn-send-otp').onclick = () => this.sendOTP();
                s('btn-verify-otp').onclick = () => this.verifyOTP();
                s('btn-reset').onclick = () => this.nav('dashboard-view');
                s('btn-print').onclick = () => window.print();
                s('btn-guide').onclick = () => alert('راهنما: انتخاب دعوی -> جواب بدهید.');
                
                // دکمه جدید برای تکمیل نهایی
                s('btn-update-doc').onclick = () => this.updateFinalInputs();
                
                document.querySelectorAll('.crime-btn').forEach(btn => { 
                    btn.onclick = (e) => this.startWizard(e.currentTarget.dataset.crime); 
                });
            },
            nav: function(viewId) {
                document.querySelectorAll('section').forEach(el => el.classList.add('hidden'));
                const target = document.getElementById(viewId);
                if(target) {
                    target.classList.remove('hidden');
                    this.state.view = viewId;
                    window.scrollTo(0,0);
                }
            },
            sendOTP: function() {
                const val = document.getElementById('mobile-input').value;
                if(val.length > 5) { 
                    this.state.mobile = val; 
                    document.getElementById('display-mobile').innerText = val; 
                    document.getElementById('step-phone').classList.add('hidden'); 
                    document.getElementById('step-otp').classList.remove('hidden'); 
                } else { 
                    this.showToast('شماره نامعتبر است'); 
                }
            },
            verifyOTP: function() {
                const val = document.getElementById('otp-input').value;
                if(val.length === 4) { 
                    this.showToast('ورود موفقیت‌آمیز'); 
                    this.nav('dashboard-view'); 
                } else { 
                    this.showToast('کد اشتباه است'); 
                }
            },
            startWizard: function(crime) {
                this.state.selectedCrime = crime;
                this.state.step = 0;
                this.state.answers = {};
                this.nav('wizard-view');
                setTimeout(() => this.renderStep(), 100);
            },
            renderStep: function() {
                const qList = this.questions[this.state.selectedCrime];
                if(this.state.step < qList.length) {
                    this.renderTimeline(qList);
                    const q = qList[this.state.step];
                    
                    const title = document.getElementById('question-title');
                    title.innerText = q.text;
                    title.classList.remove('fade-enter');
                    void title.offsetWidth; 
                    title.classList.add('fade-enter');

                    this.renderOptions(q);
                } else { 
                    this.finish(); 
                }
            },
            renderTimeline: function(qList) {
                const container = document.getElementById('timeline-area');
                container.innerHTML = '';
                
                for (let i = 0; i < this.state.step; i++) {
                    const q = qList[i];
                    const ans = this.state.answers[q.id];
                    const div = document.createElement('div');
                    div.className = 'step-item done';
                    div.innerHTML = `
                        <div class="step-circle"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div>
                        <div class="step-content pt-1">
                            <h4 class="text-slate-800 text-sm font-bold truncate">${q.text}</h4>
                            <p class="text-slate-400 text-xs truncate">پاسخ: ${ans}</p>
                        </div>
                    `;
                    container.appendChild(div);
                }

                if(this.state.step < qList.length) {
                    const q = qList[this.state.step];
                    const div = document.createElement('div');
                    div.className = 'step-item active';
                    div.innerHTML = `
                        <div class="step-circle">${this.state.step + 1}</div>
                        <div class="step-content pt-1">
                            <h4 class="text-primary text-sm font-bold">${q.text}</h4>
                            <p class="text-slate-400 text-xs">در حال پاسخگویی...</p>
                        </div>
                    `;
                    container.appendChild(div);
                }
            },
            renderOptions: function(q) {
                const area = document.getElementById('input-area');
                area.innerHTML = ''; // پاکسازی قبل از شروع برای جلوگیری از دکمه تکرار

                if(q.type === 'choice') {
                    // گرید گزینه‌ها
                    const grid = document.createElement('div');
                    grid.className = 'options-grid fade-enter';
                    q.options.forEach(opt => {
                        const btn = document.createElement('div');
                        btn.className = 'option-btn';
                        btn.innerHTML = opt;
                        // کلیک روی گزینه -> پر کردن ورودی
                        btn.onclick = () => {
                            const inp = document.getElementById('custom-input');
                            if(inp) inp.value = opt;
                            
                            // تمرکز روی ورودی برای آسانی کاربر
                            inp.focus();
                        };
                        grid.appendChild(btn);
                    });
                    area.appendChild(grid);

                    // ورودی متن (همیشه پایین)
                    const textWrapper = document.createElement('div');
                    textWrapper.className = "input-wrapper fade-enter";
                    textWrapper.innerHTML = `
                        <div class="text-xs text-slate-500 mb-2 text-center">پاسخ خود را بنویسید:</div>
                    `;
                    const inp = document.createElement('input');
                    inp.type = "text";
                    inp.id = "custom-input";
                    inp.className = "text-input";
                    // مثال درون باکس (Placeholder)
                    inp.placeholder = "مثلاً: " + (q.placeholder || 'پاسخ خاص');
                    inp.autocomplete = "off";
                    
                    // رویداد Enter
                    inp.addEventListener("keypress", (e) => { if (e.key === "Enter") document.getElementById('btn-submit-main').click(); });

                    textWrapper.appendChild(inp);
                    area.appendChild(textWrapper);

                } else {
                    // ورودی تک خط معمولی
                    const div = document.createElement('div');
                    div.className = "input-wrapper fade-enter";
                    const inp = document.createElement('input');
                    inp.type = "text";
                    inp.className = "text-input";
                    // مثال درون باکس
                    inp.placeholder = "مثلاً: " + (q.placeholder || 'توضیحات');
                    inp.autocomplete = "off";
                    inp.id = "custom-input";
                    
                    div.appendChild(inp);
                    area.appendChild(div);
                }

                // دکمه تایید اصلی (پایین همه چیز)
                const btn = document.createElement('button');
                btn.className = "btn-primary";
                btn.innerHTML = 'تایید و ادامه';
                btn.id = "btn-submit-main"; // شناسه برای جلوگیری از تکرار
                btn.onclick = () => { 
                    const inp = document.getElementById('custom-input');
                    if(inp && inp.value.trim()) this.submitCurrent(); 
                    else this.showToast('لطفا پاسخ را وارد کنید');
                };
                area.appendChild(btn);
            },
            
            prevStep: function() {
                if(this.state.step > 0) {
                    const qList = this.questions[this.state.selectedCrime];
                    const currentQ = qList[this.state.step];
                    const currentQId = currentQ.id;
                    delete this.state.answers[currentQId];
                    
                    this.state.step--;
                    this.renderStep();
                }
            },
            submitCurrent: function(val = null) {
                const inp = document.getElementById('custom-input');
                if(!inp) return alert('ورودی پیدا نشد');
                
                const finalVal = val || inp.value.trim();
                if(!finalVal) return alert('لطفا پاسخ را وارد کنید');

                const qList = this.questions[this.state.selectedCrime];
                const q = qList[this.state.step];
                
                this.state.answers[q.id] = finalVal;
                this.state.step++;
                this.renderStep();
            },
            finish: function() {
                document.getElementById('wizard-content').innerHTML = `
                    <div class="text-center py-20">
                        <div class="w-20 h-20 bg-emerald-50 text-emerald-600 rounded-full flex items-center justify-center mx-auto mb-6 animate-bounce">
                            <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800">پایان مصاحبه</h2>
                        <p class="text-slate-500 mt-2">در حال تنظیم شکوائیه استاندارد...</p>
                        <div class="w-16 h-1 bg-emerald-200 rounded-full mx-auto mt-8 overflow-hidden"><div class="h-full bg-primary animate-pulse" style="width: 50%"></div></div>
                    </div>
                `;
                setTimeout(() => {
                    this.generateDoc();
                    this.nav('result-view');
                }, 2000);
            },
            // جدید: آپدیت کردن ورودی‌های نهایی و رندر مجدد
            updateFinalInputs: function() {
                const finalClaimsInput = document.getElementById('final-claims');
                const finalRefsInput = document.getElementById('final-references');
                
                if(finalClaimsInput) this.state.claims = finalClaimsInput.value.trim();
                if(finalRefsInput) this.state.references = finalRefsInput.value.trim();
                
                // رندر مجدد سند با اطلاعات جدید
                this.generateDoc();
                
                // دکمه دانلود را دوباره رندر میکنیم تا مطمئن شویم آپدیت می‌شود
                const btn = document.getElementById('btn-print');
                // تغییر موقت متن دکمه برای فیدبک کاربر
                const originalText = btn.innerHTML;
                btn.innerHTML = 'سند بروزرسانی شد...';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 1000);

                this.showToast('سند با موفقیت بروزرسانی شد');
            },
            generateDoc: function() {
                const ans = this.state.answers;
                const crime = this.state.selectedCrime;
                const date = new Date().toLocaleDateString('fa-IR');
                document.getElementById('doc-date').innerText = date;
                
                // مقداردهی منافع
                let title = "شکوائیه", law = "";
                if(crime === 'betrayal') { title = "شکوائیه خیانت در امانت"; law = "ماده ۶۷۴"; }
                else if(crime === 'insult') { title = "شکوائیه توهین"; law = ans.gov_employee === 'بله' ? "ماده ۶۰۹" : "ماده ۶۰۸"; }
                else { title = "شکوائیه مزاحمت"; law = "ماده ۶۴۱"; }
                
                const dellalPart = ans.dellal ? `<p><strong>شرح دلایل و توضیحات:</strong> ${ans.dellal}</p>` : '';
                // استفاده از ورودی‌های نهایی (که حالا در state است)
                const claimsPart = this.state.claims ? `<p><strong>مطالب خواسته‌ها:</strong> ${this.state.claims}</p>` : '';
                const referencesPart = this.state.references ? `<p><strong>منابع و رفرنس:</strong> ${this.state.references}</p>` : '';
                
                const html = `<h1>${title}</h1><div style="display: flex; justify-content: space-between; margin-bottom: 50px; font-size: 12pt; border-bottom: 2px solid #000; padding-bottom: 10px;"><span>شماره پرونده: _________</span><span>تاریخ: ${date}</span></div><p><strong>ریاست محترم دادسرای عمومی و انقلاب __________</strong></p><p><strong>موضوع: ${title} به استناد ${law}</strong></p><br><p>احتراماً، اینجانب به شماره ملی ____________ به طرفیت مشتکی‌عنه ناشناس/معلوم بدین‌وسیله اعلام شکایت می‌نمایم.</p><p>شرح واقعه بدین‌صورت است که در تاریخ ${ans.date || '...'}، مشتکی‌عنه اقدام به ${this.getDesc(crime, ans)} نموده که این امر موجب جرم ${title} و نقض حیثیت اینجانب گردیده است.</p>${dellalPart}<br>${claimsPart}<br>${referencesPart}<br><p>ضمن اینکه خواهان رسیدگی فوری و مجازات متهم به استناد ${law} و جبران خسارات وارده می‌باشم.</p><br><br><br><br><div style="display: flex; justify-content: space-between; align-items: flex-end;"><span>با احترام</span><div style="text-align: center;"><p>امضاء و اثر انگشت شاکی</p><br><p>شاکی</p></div></div>`;
                
                document.getElementById('printable-area').innerHTML = html;
                
                // نمایش خلاصه اطلاعات اصلی (بدون منافع)
                let summary = '';
                Object.entries(ans).forEach(([k,v]) => { 
                    summary += `<div class="flex justify-between border-b border-slate-50 pb-2"><span class="text-slate-500">${k}:</span><span class="font-bold text-slate-900">${v}</span></div>`; 
                });
                document.getElementById('summary-info').innerHTML = summary;
            },
            getDesc: function(c, a) {
                if(c === 'betrayal') return `عدم استرداد عین ${a.item_type}`;
                if(c === 'insult') return `توهین آمیز ${a.medium}`;
                return `مزاحمت ${a.type}`;
            },
            showToast: function(msg) {
                const t = document.getElementById('toast');
                document.getElementById('toast-msg').innerText = msg;
                t.style.opacity = '1';
                t.style.top = '100px';
                setTimeout(() => { t.style.opacity = '0'; t.style.top = '96px'; }, 3000);
            }
        };

        window.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>